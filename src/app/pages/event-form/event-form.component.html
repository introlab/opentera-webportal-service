<div class="page-container">

  <h1>{{title}}</h1>

  <form [formGroup]="eventForm">
    <h4>Informations</h4>
    <mat-form-field appearance="outline">
      <mat-label>Clinicien</mat-label>
      <input matInput formControlName="clinician">
    </mat-form-field>
    <mat-form-field appearance="outline">
      <mat-label>Nom de l'événement</mat-label>
      <input matInput formControlName="name" [placeholder]="title">
      <mat-error>
        {{required}}
      </mat-error>
    </mat-form-field>

    <h4>Date et heures</h4>
    <mat-form-field appearance="outline">
      <mat-label>
        Date
      </mat-label>
      <input matInput [owlDateTimeTrigger]="startDate" [owlDateTime]="startDate" formControlName="startDate">
      <owl-date-time [pickerType]="'calendar'" #startDate></owl-date-time>
      <mat-error>
        {{required}}
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>
        Début
      </mat-label>
      <input matInput [owlDateTimeTrigger]="start" [owlDateTime]="start" formControlName="startTime">
      <owl-date-time [pickerType]="'timer'" [stepMinute]="15" #start></owl-date-time>
      <mat-error class="time-error" *ngIf="eventForm.controls.endTime.hasError('startTimeAfterEndTime')">
        L'heure de début doit être avant l'heure de fin.
      </mat-error>
      <mat-error *ngIf="eventForm.controls.startTime.hasError('required')">
        {{required}}
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>
        Fin
      </mat-label>
      <input matInput [owlDateTimeTrigger]="end" [owlDateTime]="end" formControlName="endTime">
      <owl-date-time [pickerType]="'timer'" [stepMinute]="15" #end></owl-date-time>
      <mat-error *ngIf="eventForm.controls.endTime.hasError('required')">
        {{required}}
      </mat-error>
    </mat-form-field>

    <div *ngIf="eventForm.hasError('timesOverlapping')" class="period overlap">
      <mat-icon>close</mat-icon>
      Cette période est déjà occupée.
    </div>
    <div *ngIf="!eventForm.hasError('timesOverlapping')" class="period free">
      <mat-icon>check</mat-icon>
      Cette période est libre.
    </div>

    <h4>Type de séance</h4>
    <app-session-type-selector [idEventSessionType]="session?.id_session_type"
                               [form]="eventForm"></app-session-type-selector>

    <app-selected-participants [selectedParticipants]="sessionParticipants"
                               (participantsChange)="participantsChange($event)"></app-selected-participants>
  </form>

  <div class="buttons" mat-dialog-actions>
    <button mat-button [disabled]=!canSave (click)="validate()">
      <mat-icon mat-list-icon>save</mat-icon>
      <span>Sauvegarder</span>
    </button>
    <button mat-button (click)="cancel()">
      <mat-icon mat-list-icon>close</mat-icon>
      <span>Annuler</span>
    </button>
  </div>
</div>
